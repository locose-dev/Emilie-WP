!function(u){var l={minimumResultsForSearch:10,width:"70%"},h=function(){var s=u("<div/>").addClass("feedback").hide();return s.setNotice=function(t){var e=u("<p/>").html(t),i=u("<button/>").addClass("notice-dismiss");return i.on("click",function(t){t.preventDefault(),s.hide()}),u(this).removeClass().addClass("feedback"),u(this).html(e).append(i),this},s.setSuccess=function(t){return this.setNotice(t),u(this).addClass("success"),this},s.setError=function(t){return this.setNotice(t),u(this).addClass("error"),this},s};u.fn.applySourceImport=function(t){this.each(function(){var i=this,e=u(this).data("type-import"),s=u(this).find("button.ilj-import"),o=u(this).find(".spinner"),n=u(this).find('select[name="ilj-import-intern-type"]'),r=u(this).find('input[type="checkbox"][id^="ilj-import-intern-"]'),a=h();a.insertBefore(u(this)),i.sourceSelection=[],r.each(function(){u(this).on("change",function(){var e=u(this).attr("name");u(this).is(":checked")?i.sourceSelection.push(e):i.sourceSelection=u.grep(i.sourceSelection,function(t){return t!=e})})}),s.on("click",function(t){if(t.preventDefault(),a.hide(),u(this).attr("disabled",!0).removeClass("button-primary"),o.addClass("is-active"),null==n.val()||0===i.sourceSelection.length)return a.setError(ilj_tools.translation.error_import_selection).show(),o.removeClass("is-active"),void u(this).attr("disabled",!1).addClass("button-primary");u.ajax({url:ilj_tools.ajax_url,data:{action:"ilj_import_keyword_intern",nonce:ilj_tools.nonce,type_import:e,type_selection:n.val(),source_import:i.sourceSelection},type:"POST",success:function(t){a.setSuccess(ilj_tools.translation.import_success).show(),n.find("option:selected").prop("selected",!1),n.ilj_select2(l),r.each(function(){u(this).prop("checked",!1)})},error:function(t){a.setError(ilj_tools.translation.error).show()},complete:function(t,e){o.removeClass("is-active"),s.attr("disabled",!1).addClass("button-primary")}})})})},u.fn.applyFileImport=function(t){var p=this;return this.createLoadingText=function(){var t=u("<span></span>").html("<small>"+ilj_tools.translation.loading+" - <span>0</span>%</small>").hide();return t.setPercent=function(t){u(this).find("span").text(t)},t},this.each(function(){var s=u.extend({fileSize:0,fileType:"."},u(this).data()),t=u(this).find('form[name^="ilj-import"]'),i=t.find(".import-file"),o=t.find(".button"),n=t.find(".ilj-progress"),r=n.find(".ilj-progress-bar"),e=t.find(".hint"),a=h(),l=p.createLoadingText(),c=u("<button/>").addClass("button button-primary ilj-import-settings-start").text(ilj_tools.translation.start_import).on("click",function(t){t.preventDefault(),d.hide(),u(this).attr("disabled",!0).removeClass("button-primary");var i=u("<span/>").addClass("spinner");u(this).after(i),i.addClass("is-active"),u.ajax({url:ilj_tools.ajax_url,data:{action:"ilj_start_import",nonce:ilj_tools.nonce,file_type:s.fileType},type:"POST",success:function(t){setTimeout(function(){a.hide(),o.show(),a.setSuccess(ilj_tools.translation.import_success),c.hide().attr("disabled",!1).addClass("button-primary"),i.remove(),a.show()},500)},error:function(t){var e=ilj_tools.translation.error;t.responseJSON.data&&(e=t.responseJSON.data),a.setError(e),setTimeout(function(){c.hide().attr("disabled",!1).addClass("button-primary"),d.hide(),a.show(),o.show(),i.remove()},500)}})}).hide().insertAfter(e),d=u("<button/>").addClass("button").text(ilj_tools.translation.cancel_import).on("click",function(t){t.preventDefault(),o.show(),a.hide(),c.hide(),d.hide()}).hide().insertAfter(c);r.setPercent=function(t){u(this).css("width",t+"%")},a.insertAfter(e),n.after(l),o.on("click",function(t){t.preventDefault(),i.click()}),i.on("change",function(t){if(t.preventDefault(),i[0].files[0].size>s.fileSize)a.setError(ilj_tools.translation.upload_error_filesize).show();else{var e=new FormData;e.append("action","ilj_upload_import"),e.append("file_type",s.fileType),e.append("file_data",i[0].files[0]),e.append("file_name",i[0].files[0].name),e.append("nonce",ilj_tools.nonce),u.ajax({url:ilj_tools.ajax_url,data:e,processData:!1,contentType:!1,dataType:"json",type:"POST",success:function(t){a.setNotice(ilj_tools.translation.upload_success),d.after(u("<div/>").addClass("clear")),setTimeout(function(){n.hide(),l.hide(),a.show(),d.show(),c.show()},800)},error:function(t){var e=ilj_tools.translation.error;t.responseJSON.data&&(e=t.responseJSON.data),a.setError(e),setTimeout(function(){n.hide(),l.hide(),a.show(),o.show()},800)},beforeSend:function(){a.hide(),o.hide(),r.setPercent(0),l.setPercent(0),n.show(),l.show()},xhr:function(){var t=u.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;e=e.toFixed(2),r.setPercent(e),l.setPercent(e)}},!1),t}}),u(this).val("")}})}),this},u(document).ready(function(){u(".ilj-upload-form").applyFileImport(),u("button.ilj-export").on("click",function(){var t=u(this).data("export"),e=u(this).parent().find(".spinner");e.addClass("is-active");var i=window.location.href+"&ilj_export="+t;"keywords"==t&&(u(this).closest(".wrap").find("input#ilj-export-empty").is(":checked")&&(i+="&empty=1"));var s=u("<iframe/>").attr("src",i).css("display","none");u("body").append(s),setTimeout(function(){e.removeClass("is-active")},500)}),jQuery("#ilj-import-intern-type-post, #ilj-import-intern-type-term").ilj_select2(l),u(".ilj-import-keywords").applySourceImport()})}(jQuery);